<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Leave a Google Review - Grand Senheng Temerloh</title>
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,600&display=swap" rel="stylesheet" />
  <style>
    :root{
      --primary:#2A5C82; --secondary:#FFA726; --accent:#4CAF50;
      --text:#2D3748; --background:#F7FAFC; --muted:#4A5568;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Poppins',sans-serif;background:var(--background);color:var(--text);line-height:1.6;padding:1rem}
    .container{max-width:820px;margin:0 auto}
    h2{text-align:center;font-size:1.8rem;color:var(--primary);margin:1rem 0}
    .hashtag-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.75rem;padding:0 1rem}
    .btn{border:none;border-radius:12px;padding:.9rem;font-size:1rem;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .hashtag-btn{background:var(--primary);color:#fff;box-shadow:0 2px 8px rgba(42,92,130,.1)}
    .hashtag-btn.active{background:#1f4967;box-shadow:0 4px 14px rgba(31,73,103,.15);transform:translateY(-2px)}
    .controls{background:#fff;border-radius:12px;padding:1rem;border:1px solid #E2E8F0;box-shadow:0 3px 10px rgba(0,0,0,.04);margin:1rem}
    .label{font-size:.95rem;margin-bottom:.4rem}
    .custom-input{width:100%;resize:vertical;min-height:90px;padding:.8rem;border-radius:10px;border:1px solid #CBD5E0;font-size:.98rem}
    .usp-list{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.6rem}
    .usp-item{display:flex;align-items:center;gap:.4rem;background:#f7fafc;padding:.4rem .6rem;border-radius:8px;border:1px solid #e2e8f0}
    .preview-card{background:#fff;border-radius:12px;padding:1rem;margin:0.6rem 1rem;border:1px solid #E2E8F0;box-shadow:0 4px 12px rgba(0,0,0,.05)}
    .preview-text{font-size:1rem;white-space:pre-wrap;color:var(--text);word-break:break-word}
    .actions{display:flex;gap:.6rem;align-items:center;justify-content:flex-end;margin-top:.6rem}
    .copy-btn{background:var(--accent);color:#fff;padding:.85rem 1rem;border-radius:12px;border:none;cursor:pointer}
    .edit-btn{background:#edf2f7;color:var(--text);padding:.6rem .8rem;border-radius:10px;border:1px solid #E2E8F0;cursor:pointer}
    .muted{color:var(--muted);font-size:.88rem}
    .small{font-size:.85rem;color:#556;margin-top:.5rem}
    .hint{font-size:.86rem;color:#666;margin-top:.5rem}
    .notification{position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);background:var(--primary);color:#fff;padding:.8rem 1.2rem;border-radius:8px;display:none;z-index:9999}
    @media(min-width:768px){.btn{font-size:1.05rem;padding:1rem}.preview-text{font-size:1.04rem}}
  </style>
</head>
<body>
  <div class="container">
    <h2>‚≠ê Choose Staff Member</h2>

    <div class="hashtag-grid" id="staff-grid" aria-label="Staff list">
      <button type="button" class="btn hashtag-btn" data-tag="mus">#mus</button>
      <button type="button" class="btn hashtag-btn" data-tag="syafiq">#syafiq</button>
      <button type="button" class="btn hashtag-btn" data-tag="faris">#faris</button>
      <button type="button" class="btn hashtag-btn" data-tag="omar">#omar</button>
      <button type="button" class="btn hashtag-btn" data-tag="maisarah">#maisarah</button>
      <button type="button" class="btn hashtag-btn" data-tag="norhakimah">#norhakimah</button>
      <button type="button" class="btn hashtag-btn" data-tag="juan">#juan</button>
    </div>

    <!-- Review controls shown after staff chosen -->
    <div id="review-section" style="display:none" aria-live="polite">
      <h2>üìù Write Your Review</h2>

      <div class="controls" aria-hidden="false">
        <div class="label">Write your own comment (required)</div>
        <textarea id="custom-comment" class="custom-input" maxlength="450" placeholder="Write your review here. Your chosen USP(s) will be appended after your text when you copy."></textarea>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:.45rem">
          <div class="muted"><span id="char-count">0</span>/450</div>
          <div style="display:flex;gap:.5rem">
            <button id="use-custom-clear" class="edit-btn" type="button">Clear</button>
            <button id="use-custom-paste" class="edit-btn" type="button">Paste sample</button>
          </div>
        </div>

        <div style="margin-top:.9rem">
          <div class="label">Select USP tags to include (these will be appended after your review)</div>
          <div class="usp-list" id="usp-list" aria-label="USP options"></div>
          <div class="small">Tip: select one or more USPs to remind reviewers what makes the offer special (S-Coin, warranty, replacement, installments, BNPL, etc.).</div>
        </div>

        <div class="hint">Live preview (what will be copied):</div>
        <div class="preview-card" aria-live="polite">
          <div id="live-preview" class="preview-text"></div>
        </div>

        <div class="actions">
          <button id="copy-review" class="copy-btn" type="button">üìã Copy & Leave Review</button>
        </div>

      </div>
    </div>
  </div>

  <div class="notification" id="notification" role="status" aria-live="assertive">Copied to clipboard! Opening Google Reviews‚Ä¶</div>

  <script>
    /* ------------------------------
       Config & data (with expanded USP options)
    -------------------------------*/
    const additionalHashtags = ['#SCoin','#Extendedwarranty','#Replacementwarranty','#O2O','#Online2Offline','#Credit','#BNPL','#BuyNowPayLater','#Instalment','#Ansuran','#MudahMilik','#UntungGila','#SenhengApp','#Point','#Cashback','#Redeem','#Delivery'];
    const googleReviewURL = 'https://maps.app.goo.gl/eReqkJwLwp1RxviF6';
    let selectedHashtag = '';

    const USP_OPTIONS = [
      // existing
      'S-Coin cashback',
      'free extra warranty',
      '1-to-1 replacement',
      '0% installment',
      'Senheng app warranty tracking',
      'nationwide flat-rate delivery',

      // BNPL options
      'Buy Now Pay Later with Atome',
      'Buy Now Pay Later with Shopee SPayLater',
      'Buy Now Pay Later with Grab PayLater',

      // Hire purchase / monthly installment
      'Monthly installment with Aeon Credit',
      'Monthly installment with Chailease'
    ];

    /* ------------------------------
       DOM refs
    -------------------------------*/
    const staffGrid = document.getElementById('staff-grid');
    const reviewSection = document.getElementById('review-section');
    const customCommentEl = document.getElementById('custom-comment');
    const charCountEl = document.getElementById('char-count');
    const uspListEl = document.getElementById('usp-list');
    const livePreviewEl = document.getElementById('live-preview');
    const copyBtn = document.getElementById('copy-review');
    const notificationEl = document.getElementById('notification');
    const useCustomClear = document.getElementById('use-custom-clear');
    const useCustomPaste = document.getElementById('use-custom-paste');

    /* ------------------------------
       Build USP checkboxes
    -------------------------------*/
    USP_OPTIONS.forEach((usp, idx) => {
      const id = 'usp-' + idx;
      const label = document.createElement('label');
      label.className = 'usp-item';
      label.innerHTML = `<input type="checkbox" id="${id}" value="${escapeHtml(usp)}"> <span style="font-size:.92rem">${escapeHtml(usp)}</span>`;
      uspListEl.appendChild(label);
    });

    function getSelectedUSPPhrases() {
      const checked = Array.from(uspListEl.querySelectorAll('input[type="checkbox"]:checked'));
      return checked.map(c => c.value);
    }

    /* ------------------------------
       Helpers
    -------------------------------*/
    function getRandomHashtags() {
      const shuffled = additionalHashtags.slice().sort(() => 0.5 - Math.random());
      const amount = Math.floor(Math.random() * 2) + 1;
      return shuffled.slice(0, amount).join(' ');
    }

    function escapeHtml(s) {
      return String(s).replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    async function writeToClipboard(text) {
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
          return true;
        } else {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly', '');
          ta.style.position = 'absolute';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          ta.setSelectionRange(0, ta.value.length);
          document.execCommand('copy');
          document.body.removeChild(ta);
          return true;
        }
      } catch (e) {
        console.error('Clipboard write failed', e);
        return false;
      }
    }

    function showNotification() {
      notificationEl.style.display = 'block';
      setTimeout(() => { notificationEl.style.display = 'none'; }, 2200);
    }

    /* ------------------------------
       USP detection: ensure user includes USP (permissive)
    -------------------------------*/
    const USP_KEYWORDS = USP_OPTIONS.map(u => u.toLowerCase().replace(/[^\w\s]/g,''));
    function containsUSPKeyword(text) {
      if (!text) return false;
      const t = text.toLowerCase();
      return USP_KEYWORDS.some(k => {
        if (!k) return false;
        const first = k.split(' ')[0];
        return (first && t.includes(first)) || t.includes(k);
      });
    }

    /* ------------------------------
       Staff click handling (delegation)
    -------------------------------*/
    staffGrid.addEventListener('click', (ev) => {
      const btn = ev.target.closest('.hashtag-btn');
      if (!btn || !staffGrid.contains(btn)) return;
      // mark active
      staffGrid.querySelectorAll('.hashtag-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      selectedHashtag = `#${btn.getAttribute('data-tag') || ''}`;
      reviewSection.style.display = 'block';
      setTimeout(() => {
        const top = reviewSection.getBoundingClientRect().top + window.scrollY - 12;
        window.scrollTo({ top, behavior: 'smooth' });
      }, 50);
      updatePreview();
      customCommentEl.focus();
    });

    /* ------------------------------
       Live preview logic
    -------------------------------*/
    function buildFinalText() {
      const user = (customCommentEl.value || '').trim();
      const usps = getSelectedUSPPhrases();
      let result = user;

      if (usps.length > 0) {
        // append USPs separated by bullet
        result = result ? `${result} ‚Äî ${usps.join(' ‚Ä¢ ')}` : usps.join(' ‚Ä¢ ');
      }

      // append staff hashtag and random extra hashtags
      const extras = getRandomHashtags();
      if (selectedHashtag) result = result ? `${result} ${selectedHashtag} ${extras}` : `${selectedHashtag} ${extras}`;
      return result.trim();
    }

    function updatePreview() {
      const finalText = buildFinalText();
      livePreviewEl.textContent = finalText || 'Your review preview will appear here.';
    }

    customCommentEl.addEventListener('input', () => {
      charCountEl.textContent = customCommentEl.value.length;
      updatePreview();
    });

    uspListEl.addEventListener('change', updatePreview);

    useCustomClear.addEventListener('click', () => {
      customCommentEl.value = '';
      charCountEl.textContent = '0';
      updatePreview();
      customCommentEl.focus();
    });

    useCustomPaste.addEventListener('click', () => {
      const sample = "Staff sangat membantu & jelas terangkan cara guna S-Coin. Sangat puas hati dengan servis hari ini.";
      customCommentEl.value = sample;
      charCountEl.textContent = sample.length;
      updatePreview();
      customCommentEl.focus();
    });

    /* ------------------------------
       Copy button behavior
    -------------------------------*/
    copyBtn.addEventListener('click', async () => {
      const userText = (customCommentEl.value || '').trim();
      if (!userText) {
        alert('Please write your review in the text area before copying. The custom comment cannot be empty.');
        customCommentEl.focus();
        return;
      }

      // ensure USP presence: if user's text doesn't contain USP keywords and no USP selected, prompt to append default
      const userHasUSP = containsUSPKeyword(userText);
      const selectedUSPs = getSelectedUSPPhrases();
      let finalText = userText;

      if (!userHasUSP) {
        if (selectedUSPs.length > 0) {
          finalText = `${finalText} ‚Äî ${selectedUSPs.join(' ‚Ä¢ ')}`;
        } else {
          const appendDefault = confirm(
            "Your review doesn't mention key selling points (USP).\n\nWould you like to append a short USP phrase (e.g. 'S-Coin cashback & free extra warranty') so the review includes the store's USP? OK to append, Cancel to edit your comment."
          );
          if (appendDefault) {
            finalText = `${finalText} ‚Äî S-Coin cashback & free extra warranty`;
          } else {
            customCommentEl.focus();
            return;
          }
        }
      }

      // append staff hashtag and random extras
      finalText = `${finalText} ${selectedHashtag} ${getRandomHashtags()}`.trim();

      const ok = await writeToClipboard(finalText);
      if (ok) {
        showNotification();
        setTimeout(() => window.open(googleReviewURL, '_blank'), 500);
      } else {
        alert('Copy failed ‚Äî please try manually selecting the preview text and copying (Ctrl/Cmd+C).');
      }
    });

    /* ------------------------------
       Init
    -------------------------------*/
    charCountEl.textContent = '0';
    updatePreview();

    // Optional: pre-select the first staff on load
    // const first = staffGrid.querySelector('.hashtag-btn');
    // if (first) first.click();

  </script>
</body>
</html>
